<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Growtopia - Dashboard</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  />
</head>

<body class="flex items-center justify-center min-h-screen bg-transparent">

  <div
    id="loginModal"
    class="relative bg-[#2b4d6d] border-4 border-[#87b8cc] shadow-lg p-8 w-[90%] max-w-lg h-64 rounded-lg
           flex flex-col justify-center opacity-0 -translate-y-5 transition-all duration-700 ease-out"
  >

    <p class="text-white text-center font-bold text-2xl mb-2">
      Log in with your Grow ID
    </p>

    <!-- ERROR -->
    <div
      id="errorDiv"
      class="hidden mb-2 text-xs text-red-600 font-bold px-2 py-1 bg-[#1f3b55] rounded"
    >
      <span id="errorMessage"></span>
    </div>

    <!-- FORM -->
    <form
      id="loginForm"
      method="post"
      action="/player/growid/login/validate"
      accept-charset="UTF-8"
      novalidate
    >
      <input type="hidden" name="type" value="log" />
      <input type="hidden" name="_token" value="<%= JSON.stringify(data) %>" />

      <!-- GROW ID -->
      <div class="mb-2">
        <label class="block text-white text-xs mb-1">GrowID</label>
        <div class="flex items-center border-2 border-[#81d4fa] rounded bg-[#2b4d6d] px-2 py-1">
          <i class="fas fa-user text-white text-xs mr-2"></i>
          <input
            id="loginGrowId"
            name="growId"
            type="text"
            class="w-full bg-transparent text-white text-xs focus:outline-none"
            placeholder="Enter your growid"
          />
        </div>
      </div>

      <!-- PASSWORD -->
      <div class="mb-2">
        <label class="block text-white text-xs mb-1">Password</label>
        <div class="flex items-center border-2 border-[#81d4fa] rounded bg-[#2b4d6d] px-2 py-1">
          <i class="fas fa-lock text-white text-xs mr-2"></i>
          <input
            id="loginPassword"
            name="password"
            type="password"
            class="w-full bg-transparent text-white text-xs focus:outline-none"
            placeholder="Enter your password"
          />
          <button
            type="button"
            id="togglePassword"
            class="ml-2 text-white text-xs"
          >
            <i class="fas fa-eye"></i>
          </button>
        </div>
      </div>

      <!-- SUBMIT -->
      <div class="flex justify-end">
        <button
          type="submit"
          id="loginButton"
          class="px-3 py-1 rounded bg-[#00b8ff] text-white text-xs
                 hover:bg-[#06a4dd] transition transform hover:scale-105"
        >
          Login
        </button>
      </div>
    </form>
  </div>

  <!-- SCRIPT -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const modal = document.getElementById("loginModal");
      const form = document.getElementById("loginForm");
      const errorDiv = document.getElementById("errorDiv");
      const errorMessage = document.getElementById("errorMessage");
      const growIdInput = document.getElementById("loginGrowId");
      const passwordInput = document.getElementById("loginPassword");
      const toggleBtn = document.getElementById("togglePassword");

      // Modal animation
      setTimeout(() => {
        modal.classList.remove("opacity-0", "-translate-y-5");
      }, 100);

      // Restore GrowID
      const savedGrowId = localStorage.getItem("growId");
      if (savedGrowId) {
        growIdInput.value = savedGrowId;
      }

      // Toggle password
      toggleBtn.addEventListener("click", () => {
        passwordInput.type =
          passwordInput.type === "password" ? "text" : "password";
      });

      // ✅ FORM SUBMIT VALIDATION (FINAL FIX)
      form.addEventListener("submit", (e) => {
        const uName = growIdInput.value.trim();
        const uPass = passwordInput.value.trim();

        if (!uName || !uPass) {
          e.preventDefault();
          errorDiv.classList.remove("hidden");
          errorMessage.textContent = "Username or Password is empty";
          return;
        }

        if (uName.length < 4 || uPass.length < 4) {
          e.preventDefault();
          errorDiv.classList.remove("hidden");
          errorMessage.textContent =
            "Username or Password must be at least 4 characters long";
          return;
        }

        // ✅ VALID → allow POST
        localStorage.setItem("growId", uName);
      });
    });
  </script>
</body>
</html>
